<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>我的手绘风导航网</title>
  <link rel="stylesheet" href="./style.css">
</head>
<body>
  <header></header>
  <main> 
      <div class="wrapper" id="main"></div>
      <script>
          /*1.0 初始化数据*/ 
          var hashT = init() /*hashT是一个哈希，其值对也是一个哈希表*/
          var hash = hashT['hash']
          var keys = hashT['keys']
            
          /*2.0 生成键盘*/
          //用js写html //div自动换行功能//创建div和kbd，和kbd内容//先有while循环再有for循环
          generateKeyboard(hash,keys)
        
          /*3.0 监听用户动作*/
          listenToUser(hash)
          
          /*4.0 自定义函数工具*/
          function init(){
            var keys = {//定义键盘值数组。疑惑，引号加不加有什么影响？
                        0:{0:'q',1:'w',2:'e',3:'r',4:'t',5:'y',6:'u',7:'i',8:'o',9:'p','length':10},
                        1:{0:'a',1:'s',2:'d',3:'f',4:'g',5:'h',6:'j',7:'k',8:'l','length':9},
                        2:{0:'z',1:'x',2:'c',3:'v',4:'b',5:'n',6:'m','length':7},
                        'length': 3
                       }
            //定义网站hash表
            var hash = {'q':'www.qq.com','w':'weibo.com','e':'ele.me','r':'renren.com',
                        't':'baby.taobao.com','y':'youtube.com','u':'uc.com','i':'iqiyi.com','o':'opera.com',
                        'p':undefined,'a':'acfun.tv','s':'sohu.com','d':'dribbble.com','f':'facebook.com',
                        'g':'google.com','h':undefined,'j':'jd.com','k':undefined,'l':undefined,'z':'zhihu.com',
                        'x':undefined,'c':'css-tricks.com','v':'visualgo.net','b':undefined,'n':undefined,'m':undefined
                       }
            //每次优先读取localStorage 里 randomN 对应的hash 每次刷新网页重新读档
            var hashInLocalStorage = getFromLocalStorage('randomN')
            if(hashInLocalStorage)
                    {
                      hash = hashInLocalStorage  
                    }
            return {
                      "keys": keys,
                      "hash": hash
                   }
          }

          function generateKeyboard(hash,keys)
          {
            for(index=0;index < keys['length'];index=index+1 ) //0 1 2
             { 
              var div = tag('div') //用js代码给文档创建三个标签元素div,注意引号
              div.className = 'row'
              main.appendChild(div)   //main父标签，div子标签 

              var row = keys[index]   //第一个数组 第二个数组 第三个数组

              for(index2 = 0;index2 < row['length'];index2 = index2 + 1)
                {
                  /*kbd不能放到后面*/
                  var kbd = tag('kbd')
                  kbd.className = 'key'
                  
                  var button = createButton(row[index2])
                  var span = createSpan(row[index2])
                  var img = createImg(hash[row[index2]])

                  kbd.appendChild(span)
                  kbd.appendChild(button)
                  kbd.appendChild(img)
                  div.appendChild(kbd)
                }
              }
          }

          function listenToUser(hash)
          {
            document.onkeypress = function(randomName)
            {
                //console.log('你按下的这个键所有信息是：')
                //console.log(randomName)   //猜想randomName是hash表名
                var key = randomName['key']     //获取用户的按键值 q w e r t y 这的key必须加引号'key'    
                var website = hash[key]         //qq.com weibo.com taobao.com 这的key不能加引号 key  
                //console.log(website)      //console.log()是调试工具
                //location.href = 'http://'+website     //模拟用户在地址栏输入地址，修改当前网址为按键地址
                window.open('http://'+website,'_blank') //新开窗口打开用户按键的网站
            }
            /*不需要返回值就不用return*/
          }

          function getFromLocalStorage(n){
            return JSON.parse(localStorage.getItem(n) || 'null')
          }
          function tag(tagName){
            return document.createElement(tagName)
          } 
          function createSpan(textContent){
                var span = tag('span') 
                span.className = 'text'
                span.textContent = textContent   //q w e r t 给kbd添加文本内容 .textContent不是一个函数, .textContent('hi')错误
                return span
          }

          function createButton(id){
                  var button = tag('button')
                  button.id = id         //给每个编辑按键加上对应的id
                  button.textContent = 'E' 
                  button.onclick = function(randomName) { //button被点击了
                    //console.log(randomName) 这里的randomName就是事件click 哈希表的名称,打印出事件的所有信息，
                    button2 = randomName['target'] //randomName['target']是用户点击的元素
                    img2 = button2.nextSibling  //button2.nextSibling 可以取到当前被点击的button2的下一个兄弟
                    var key = button2['id']   //q w e r t y 取出用户要编辑哪一个kbd的键值
                    //console.log(randomName['target']['id']  /*这里用key是错误的，这里没有按下kbd没有['key']，不能像下面一样用*/)
                    var x = prompt('请输入要变更的网址域名,如：iqiyi.com或baby.taobao.com')         //获取用户要更改的网址
                    hash[key] = x                              //hash变更
                    //console.log(hash)                  //每次都打出hash
                    //hash变更后要立刻存档到randomN
                    localStorage.setItem('randomN',JSON.stringify(hash)) //JSON.stringify(hash)是把hash变成字符串的                              //hash变更
                    if(hash[key]){img2.src = 'http://'+hash[key]+'/favicon.ico'}  //对应网站icon也要变更
                    else{img2.src = '//i.loli.net/2017/11/10/5a05afbc5e183.png'}
                    /*监听失败事件*//*console.log('获取icon失败了')*/
                    img2.onerror = function(shijianName){shijianName.target.src = '//i.loli.net/2018/11/21/5bf545065c22b.jpg'}
                    }
                  return button
          }
          
          function createImg(domain){
                var img = tag('img')
                if(domain){img.src = 'http://' + domain + '/favicon.ico'}
                else{img.src = '//i.loli.net/2017/11/10/5a05afbc5e183.png'}
               /*监听失败事件*//*console.log('获取icon失败了')*/
                img.onerror = function(shijianName){
                   shijianName.target.src = '//i.loli.net/2018/11/21/5bf545065c22b.jpg'
                   }
                return img
          }


      </script>
  </main>
  <footer></footer>
</body>
</html>